<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Translation App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <ul class="flashes">
                {% for message in messages %}
                    <li>{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
        <h1>Healthcare Translation App</h1>
        <div class="language-selection">
            <div class="language-group">
                <label for="input-language">Input Language:</label>
                <select id="input-language">
                    <option value="en">English</option>
                    <option value="hi">Hindi</option>
                    <option value="gu">Gujarati</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                </select>
            </div>
            <div>
            </div>
            <div class="language-group">
                <label for="output-language">Output Language:</label>
                <select id="output-language">
                    <option value="fr">French</option>
                    <option value="en">English</option>
                    <option value="hi">Hindi</option>
                    <option value="gu">Gujarati</option>
                    <option value="es">Spanish</option>
                    <option value="de">German</option>
                </select>
            </div>
        </div>
        
        <div class="input-container">
            <button id="speech-button" class="btn">ðŸŽ¤ Speak</button>
            <textarea id="text-to-translate" placeholder="Type text here..." required></textarea>
        </div>
        <button id="translate-button" class="btn">Translate</button>
        
        <div id="translation-output">
            <h2>Translation:</h2>
            <p id="translated-text"></p>
            <audio id="audio-output" controls></audio>
        </div>
    </div>


    <script>
        const speechButton = document.getElementById('speech-button');
        const textArea = document.getElementById('text-to-translate');

        // Check for browser support
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.interimResults = true;
            recognition.continuous = false; // Stop automatically when the user stops speaking
        
            // Set the recognition language based on the input language selection
            document.getElementById('input-language').addEventListener('change', () => {
                recognition.lang = document.getElementById('input-language').value;
            });
        
            // Listen for speech results and display in the text area
            recognition.addEventListener('result', event => {
                const transcript = Array.from(event.results)
                    .map(result => result[0])
                    .map(result => result.transcript)
                    .join('');
                textArea.value = transcript;
            });
        
            // Automatically stop recording when speech ends
            recognition.addEventListener('end', () => {
                console.log("Speech recognition stopped due to silence.");
            });
        
            // Start recognition when the button is clicked
            speechButton.addEventListener('click', () => {
                recognition.start();
            });
        } else {
            speechButton.disabled = true; // Disable button if speech recognition is not supported
            alert('Speech recognition is not supported in your browser.');
        }

        document.getElementById('translate-button').addEventListener('click', function() {
            const text = textArea.value;
            const targetLanguage = document.getElementById('output-language').value;
            const inputLanguage = document.getElementById('input-language').value;

            fetch('/translate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    text: text,
                    target_language: targetLanguage,
                    source_language: inputLanguage
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.translation) {
                    document.getElementById('translated-text').textContent = data.translation;
                    const audio = document.getElementById('audio-output');
                    audio.src = 'data:audio/mp3;base64,' + data.audio;
                } else {
                    document.getElementById('translated-text').textContent = 'Error: ' + data.error;
                }
            })
            .catch(error => {
                document.getElementById('translated-text').textContent = 'Error: ' + error.message;
            });
        });
    </script>
</body>
</html>
